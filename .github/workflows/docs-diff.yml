# Check for changes in docs output.
name: Docs Diff
on:
  pull_request:
    types: [opened, synchronize, reopened, labeled, unlabeled]
jobs:
  check-label:
    name: Check for "Docs" label
    runs-on: ubuntu-latest
    outputs:
      hadLabel: ${{ steps.label.outcome == 'skipped' }}
    steps:
      - id: label
        name: Check for "Docs" label
        run: exit 1 # Fail the job!
        if: "!contains(github.event.pull_request.labels.*.name, 'Docs')"
        continue-on-error: true
  diff:
    name: Diff
    needs: [check-label]
    outputs:
      no_diff: ${{ steps.diff.outcome != 'failure' }}
    if: ${{ !needs.check-id.outputs.hadLabel }}
    runs-on: ubuntu-latest
    steps:
      - name: Diff
        id: diff
        run: exit 1
        continue-on-error: true
  # Job that succeeds or fails depending upon the entire workflow.
  # Used as a required check.
  decide_if_pr_okay:
    name: PR docs changes okay
    if: always()
    needs: [check-label, diff]
    runs-on: ubuntu-latest
    steps:
      - run: echo ${{ toJSON(needs) }}
      - run: echo "Okay because label added."
        if: needs.diff.result == 'skipped'
      - run: echo "Not okay because no label, and diff failed." && exit 1
        if: needs.diff.result != 'skipped' && needs.diff.outputs.no_diff == 'false'
