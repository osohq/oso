
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="_static/javascripts/modernizr.js"></script>
  
  
  
    <title>sqlalchemy-oso-preview API Reference &#8212; oso Documentation</title>
    <link rel="stylesheet" href="_static/material.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/contentui.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/contentui.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=#0E024E data-md-color-accent=#FFFFFF>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#sqlalchemy" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="index.html" title="oso Documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">oso Documentation</span>
          <span class="md-header-nav__topic"> sqlalchemy-oso-preview API Reference </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/osohq/oso/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    osohq/oso
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = ""versions.json"",
        target_loc = "../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="oso Documentation" class="md-nav__button md-logo">
      
        <img src="_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="index.html"
       title="oso Documentation">oso Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/osohq/oso/" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    osohq/oso
  </div>
</a>
    </div>
  
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#sqlalchemy--page-root" class="md-nav__link">sqlalchemy-oso-preview API Reference</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#module-sqlalchemy_oso" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">sqlalchemy_oso</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#module-sqlalchemy_oso.session" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">sqlalchemy_oso.session</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#sqlalchemy-oso-roles2" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">sqlalchemy_oso.roles2</span></code></a>
        </li>
        <li class="md-nav__item"><a href="#sqlalchemy-oso-roles" class="md-nav__link"><code class="docutils literal notranslate"><span class="pre">sqlalchemy_oso.roles</span></code></a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  
<h1 id="sqlalchemy--page-root">sqlalchemy-oso-preview API Reference<a class="headerlink" href="#sqlalchemy--page-root" title="Permalink to this headline">¶</a></h1>

<span id="sqlalchemy-oso"></span><h2 id="module-sqlalchemy_oso"><code class="docutils literal notranslate"><span class="pre">sqlalchemy_oso</span></code><a class="headerlink" href="#module-sqlalchemy_oso" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="sqlalchemy_oso.SQLAlchemyOso">
<em class="property">class </em><code class="sig-prename descclassname">sqlalchemy_oso.</code><code class="sig-name descname">SQLAlchemyOso</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">sqlalchemy_base</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.SQLAlchemyOso" title="Permalink to this definition">¶</a></dt>
<dd><p>The central object to manage application policy state, e.g.
the policy data, and verify requests when using Oso with SQLAlchemy.</p>
<p>Supports SQLAlchemy-specific functionality, including data filtering and role management.</p>
<p>Accepts a SQLAlchemy declarative_base on initialization, which is used to register
all relevant SQLAlchemy models with Oso.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy_oso</span> <span class="kn">import</span> <span class="n">SQLAlchemyOso</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"MyBaseModel"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">SQLAlchemyOso</span><span class="p">(</span><span class="n">Base</span><span class="p">)</span>
<span class="go">&lt;sqlalchemy_oso.oso.SQLAlchemyOso object at 0x...&gt;</span>
</pre></div>
</div>
<dl class="py method">
<dt id="sqlalchemy_oso.SQLAlchemyOso.enable_roles">
<code class="sig-name descname">enable_roles</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">user_model</span></em>, <em class="sig-param"><span class="n">session_maker</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.SQLAlchemyOso.enable_roles" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable the Oso role management API.
Oso will create SQLAlchemy models to create and assign roles to users (stored in <cite>user_model</cite>).
The roles API methods will be available on the <cite>roles</cite> property of <cite>SQLAlchemyOso</cite>.</p>
</dd></dl>
<dl class="py method">
<dt id="sqlalchemy_oso.SQLAlchemyOso.roles">
<em class="property">property </em><code class="sig-name descname">roles</code><a class="headerlink" href="#sqlalchemy_oso.SQLAlchemyOso.roles" title="Permalink to this definition">¶</a></dt>
<dd><p>Property to access the Oso roles API methods defined in <cite>OsoRoles</cite>.
This property is only available after calling <cite>enable_roles()</cite>.</p>
</dd></dl>
</dd></dl>
<dl class="py function">
<dt id="sqlalchemy_oso.authorized_sessionmaker">
<code class="sig-prename descclassname">sqlalchemy_oso.</code><code class="sig-name descname">authorized_sessionmaker</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">get_oso</span></em>, <em class="sig-param"><span class="n">get_user</span></em>, <em class="sig-param"><span class="n">get_action</span></em>, <em class="sig-param"><span class="n">class_</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.authorized_sessionmaker" title="Permalink to this definition">¶</a></dt>
<dd><p>Session factory for sessions with oso authorization applied.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>get_oso</strong> – Callable that return oso instance to use for authorization.</p></li>
<li><p><strong>get_user</strong> – Callable that returns user for an authorization request.</p></li>
<li><p><strong>get_action</strong> – Callable that returns action for the authorization request.</p></li>
<li><p><strong>class</strong> – Base class to use for sessions.</p></li>
</ul>
</dd>
</dl>
<p>All other keyword arguments are passed through to
<code class="xref py py-func docutils literal notranslate"><span class="pre">sqlalchemy.orm.session.sessionmaker()</span></code> unchanged.</p>
</dd></dl>
<dl class="py function">
<dt id="sqlalchemy_oso.register_models">
<code class="sig-prename descclassname">sqlalchemy_oso.</code><code class="sig-name descname">register_models</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">oso</span><span class="p">:</span> <span class="n">oso.oso.Oso</span></em>, <em class="sig-param"><span class="n">base</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.register_models" title="Permalink to this definition">¶</a></dt>
<dd><p>Register all models in model base class <code class="docutils literal notranslate"><span class="pre">base</span></code> with oso as classes.</p>
</dd></dl>


<span id="sqlalchemy-oso-session"></span><h2 id="module-sqlalchemy_oso.session"><code class="docutils literal notranslate"><span class="pre">sqlalchemy_oso.session</span></code><a class="headerlink" href="#module-sqlalchemy_oso.session" title="Permalink to this headline">¶</a></h2>
<p>SQLAlchemy session classes and factories for oso.</p>
<dl class="py class">
<dt id="sqlalchemy_oso.session.AuthorizedSession">
<em class="property">class </em><code class="sig-prename descclassname">sqlalchemy_oso.session.</code><code class="sig-name descname">AuthorizedSession</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">oso</span><span class="p">:</span> <span class="n">oso.oso.Oso</span></em>, <em class="sig-param"><span class="n">user</span></em>, <em class="sig-param"><span class="n">action</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.session.AuthorizedSession" title="Permalink to this definition">¶</a></dt>
<dd><p>SQLAlchemy session that uses oso for authorization.</p>
<p>Queries on this session only return authorized objects.</p>
<p>Usually <a class="reference internal" href="#sqlalchemy_oso.session.authorized_sessionmaker" title="sqlalchemy_oso.session.authorized_sessionmaker"><code class="xref py py-func docutils literal notranslate"><span class="pre">authorized_sessionmaker()</span></code></a> is used instead of directly
instantiating the session.</p>
</dd></dl>
<dl class="py class">
<dt id="sqlalchemy_oso.session.AuthorizedSessionBase">
<em class="property">class </em><code class="sig-prename descclassname">sqlalchemy_oso.session.</code><code class="sig-name descname">AuthorizedSessionBase</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">oso</span><span class="p">:</span> <span class="n">oso.oso.Oso</span></em>, <em class="sig-param"><span class="n">user</span></em>, <em class="sig-param"><span class="n">action</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">options</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.session.AuthorizedSessionBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Mixin for SQLAlchemy Session that uses oso authorization for queries.</p>
<p>Can be used to create a custom session class that uses oso:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MySession</span><span class="p">(</span><span class="n">AuthorizedSessionBase</span><span class="p">,</span> <span class="n">sqlalchemy</span><span class="o">.</span><span class="n">orm</span><span class="o">.</span><span class="n">Session</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</dd></dl>
<dl class="py function">
<dt id="sqlalchemy_oso.session.authorized_sessionmaker">
<code class="sig-prename descclassname">sqlalchemy_oso.session.</code><code class="sig-name descname">authorized_sessionmaker</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">get_oso</span></em>, <em class="sig-param"><span class="n">get_user</span></em>, <em class="sig-param"><span class="n">get_action</span></em>, <em class="sig-param"><span class="n">class_</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.session.authorized_sessionmaker" title="Permalink to this definition">¶</a></dt>
<dd><p>Session factory for sessions with oso authorization applied.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>get_oso</strong> – Callable that return oso instance to use for authorization.</p></li>
<li><p><strong>get_user</strong> – Callable that returns user for an authorization request.</p></li>
<li><p><strong>get_action</strong> – Callable that returns action for the authorization request.</p></li>
<li><p><strong>class</strong> – Base class to use for sessions.</p></li>
</ul>
</dd>
</dl>
<p>All other keyword arguments are passed through to
<code class="xref py py-func docutils literal notranslate"><span class="pre">sqlalchemy.orm.session.sessionmaker()</span></code> unchanged.</p>
</dd></dl>
<dl class="py function">
<dt id="sqlalchemy_oso.session.scoped_session">
<code class="sig-prename descclassname">sqlalchemy_oso.session.</code><code class="sig-name descname">scoped_session</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">get_oso</span></em>, <em class="sig-param"><span class="n">get_user</span></em>, <em class="sig-param"><span class="n">get_action</span></em>, <em class="sig-param"><span class="n">scopefunc</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.session.scoped_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a scoped session maker that uses the user and action as part of the scope function.</p>
<p>Use in place of sqlalchemy’s <a class="reference external" href="https://docs.sqlalchemy.org/en/13/orm/contextual.html">scoped_session</a></p>
<p>Uses <a class="reference internal" href="#sqlalchemy_oso.session.authorized_sessionmaker" title="sqlalchemy_oso.session.authorized_sessionmaker"><code class="xref py py-func docutils literal notranslate"><span class="pre">authorized_sessionmaker()</span></code></a> as the factory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>get_oso</strong> – Callable that return oso instance to use for authorization.</p></li>
<li><p><strong>get_user</strong> – Callable that returns user for an authorization request.</p></li>
<li><p><strong>get_action</strong> – Callable that returns action for the authorization request.</p></li>
<li><p><strong>scopefunc</strong> – Additional scope function to use for scoping sessions.
Output will be combined with the oso, action and user objects.</p></li>
<li><p><strong>kwargs</strong> – Additional keyword arguments to pass to
<a class="reference internal" href="#sqlalchemy_oso.session.authorized_sessionmaker" title="sqlalchemy_oso.session.authorized_sessionmaker"><code class="xref py py-func docutils literal notranslate"><span class="pre">authorized_sessionmaker()</span></code></a>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt id="sqlalchemy_oso.session.set_get_session">
<code class="sig-prename descclassname">sqlalchemy_oso.session.</code><code class="sig-name descname">set_get_session</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">oso</span><span class="p">:</span> <span class="n">oso.oso.Oso</span></em>, <em class="sig-param"><span class="n">get_session_func</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.session.set_get_session" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the function that oso uses to expose a SQLAlchemy session to the policy</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>oso</strong> (<a class="reference internal" href="index.html#oso.Oso" title="oso.Oso"><em>Oso</em></a>) – The Oso instance used to evaluate the policy.</p></li>
<li><p><strong>get_session_func</strong> (<em>lambda</em>) – A function that returns a SQLAlchemy session</p></li>
</ul>
</dd>
</dl>
<p>The session can be accessed from polar via the OsoSession constant. E.g.,</p>
<div class="highlight-polar notranslate"><div class="highlight"><pre><span></span>OsoSession<span class="p">.</span><span class="k">get</span><span class="p">().</span><span class="k">query</span><span class="p">(...)</span>
</pre></div>
</div>
</dd></dl>


<h2 id="sqlalchemy-oso-roles2"><code class="docutils literal notranslate"><span class="pre">sqlalchemy_oso.roles2</span></code><a class="headerlink" href="#sqlalchemy-oso-roles2" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This module is in early access and subject to breaking changes in the near-term.</p>
</div>
<span class="target" id="module-sqlalchemy_oso.roles2"></span><dl class="py class">
<dt id="sqlalchemy_oso.roles2.OsoRoles">
<em class="property">class </em><code class="sig-prename descclassname">sqlalchemy_oso.roles2.</code><code class="sig-name descname">OsoRoles</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">oso</span></em>, <em class="sig-param"><span class="n">sqlalchemy_base</span></em>, <em class="sig-param"><span class="n">user_model</span></em>, <em class="sig-param"><span class="n">session_maker</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles2.OsoRoles" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize OsoRoles.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>oso</strong> – The oso instance to use with roles.</p></li>
<li><p><strong>sqlalchemy_base</strong> – The SQLAlchemy base model to create roles for.</p></li>
<li><p><strong>user_model</strong> – The user model to associate roles with.</p></li>
<li><p><strong>session_maker</strong> – A SQLAlchemy session factory. The session factory
cannot be an authorized session.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="sqlalchemy_oso.roles2.OsoRoles.assign_role">
<code class="sig-name descname">assign_role</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">user</span></em>, <em class="sig-param"><span class="n">resource</span></em>, <em class="sig-param"><span class="n">role_name</span></em>, <em class="sig-param"><span class="n">session</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">reassign</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles2.OsoRoles.assign_role" title="Permalink to this definition">¶</a></dt>
<dd><p>Assign <cite>user</cite> to <cite>role_name</cite> on <cite>resource</cite>.</p>
<p>Flushes the session after assigning the role. Commits if the session was
not passed in.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>session</strong> – Session to perform assignment with. If not provided,</p>
</dd>
</dl>
<p>creates one using the sessionmaker that <cite>self</cite> was initialized with.
:param reassign: Set to False to error on reassignment of roles.</p>
</dd></dl>
<dl class="py method">
<dt id="sqlalchemy_oso.roles2.OsoRoles.assignments_for_resource">
<code class="sig-name descname">assignments_for_resource</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">resource</span></em>, <em class="sig-param"><span class="n">session</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles2.OsoRoles.assignments_for_resource" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve role assignments for <code class="docutils literal notranslate"><span class="pre">resource</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A list of role assignments for <code class="docutils literal notranslate"><span class="pre">resource</span></code> Each assignment has
a <code class="docutils literal notranslate"><span class="pre">user_id</span></code> key and <code class="docutils literal notranslate"><span class="pre">role</span></code> key.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt id="sqlalchemy_oso.roles2.OsoRoles.for_resource">
<code class="sig-name descname">for_resource</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">resource_class</span></em>, <em class="sig-param"><span class="n">session</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles2.OsoRoles.for_resource" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve roles assigned for <code class="docutils literal notranslate"><span class="pre">resource_class</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A list of role objects with a <code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">resource_type</span></code> property.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt id="sqlalchemy_oso.roles2.OsoRoles.remove_role">
<code class="sig-name descname">remove_role</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">user</span></em>, <em class="sig-param"><span class="n">resource</span></em>, <em class="sig-param"><span class="n">role_name</span></em>, <em class="sig-param"><span class="n">session</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles2.OsoRoles.remove_role" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove <cite>user</cite> assignment to <cite>role_name</cite> on <cite>resource</cite>.</p>
<p>Flushes the session after removing the role. Commits if the session was
not passed in.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>session</strong> – Session to perform assignment with. If not provided,</p>
</dd>
</dl>
<p>creates one using the sessionmaker that <cite>self</cite> was initialized with.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>True if the role was removed, False otherwise.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt id="sqlalchemy_oso.roles2.OsoRoles.synchronize_data">
<code class="sig-name descname">synchronize_data</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">session</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles2.OsoRoles.synchronize_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Call to load the roles data from the policy to the database so that it can be evaluated.
This must be called every time the policy changes, usually as part of a deploy script.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt id="id0">
<em class="property">class </em><code class="sig-prename descclassname">sqlalchemy_oso.roles2.</code><code class="sig-name descname">OsoRoles</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">oso</span></em>, <em class="sig-param"><span class="n">sqlalchemy_base</span></em>, <em class="sig-param"><span class="n">user_model</span></em>, <em class="sig-param"><span class="n">session_maker</span></em><span class="sig-paren">)</span><a class="headerlink" href="#id0" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize OsoRoles.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>oso</strong> – The oso instance to use with roles.</p></li>
<li><p><strong>sqlalchemy_base</strong> – The SQLAlchemy base model to create roles for.</p></li>
<li><p><strong>user_model</strong> – The user model to associate roles with.</p></li>
<li><p><strong>session_maker</strong> – A SQLAlchemy session factory. The session factory
cannot be an authorized session.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="id1">
<code class="sig-name descname">assign_role</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">user</span></em>, <em class="sig-param"><span class="n">resource</span></em>, <em class="sig-param"><span class="n">role_name</span></em>, <em class="sig-param"><span class="n">session</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">reassign</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#id1" title="Permalink to this definition">¶</a></dt>
<dd><p>Assign <cite>user</cite> to <cite>role_name</cite> on <cite>resource</cite>.</p>
<p>Flushes the session after assigning the role. Commits if the session was
not passed in.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>session</strong> – Session to perform assignment with. If not provided,</p>
</dd>
</dl>
<p>creates one using the sessionmaker that <cite>self</cite> was initialized with.
:param reassign: Set to False to error on reassignment of roles.</p>
</dd></dl>
<dl class="py method">
<dt id="id2">
<code class="sig-name descname">assignments_for_resource</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">resource</span></em>, <em class="sig-param"><span class="n">session</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#id2" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve role assignments for <code class="docutils literal notranslate"><span class="pre">resource</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A list of role assignments for <code class="docutils literal notranslate"><span class="pre">resource</span></code> Each assignment has
a <code class="docutils literal notranslate"><span class="pre">user_id</span></code> key and <code class="docutils literal notranslate"><span class="pre">role</span></code> key.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt id="id3">
<code class="sig-name descname">for_resource</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">resource_class</span></em>, <em class="sig-param"><span class="n">session</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#id3" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve roles assigned for <code class="docutils literal notranslate"><span class="pre">resource_class</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A list of role objects with a <code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">resource_type</span></code> property.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt id="id4">
<code class="sig-name descname">remove_role</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">user</span></em>, <em class="sig-param"><span class="n">resource</span></em>, <em class="sig-param"><span class="n">role_name</span></em>, <em class="sig-param"><span class="n">session</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#id4" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove <cite>user</cite> assignment to <cite>role_name</cite> on <cite>resource</cite>.</p>
<p>Flushes the session after removing the role. Commits if the session was
not passed in.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>session</strong> – Session to perform assignment with. If not provided,</p>
</dd>
</dl>
<p>creates one using the sessionmaker that <cite>self</cite> was initialized with.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>True if the role was removed, False otherwise.</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt id="id5">
<code class="sig-name descname">synchronize_data</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">session</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#id5" title="Permalink to this definition">¶</a></dt>
<dd><p>Call to load the roles data from the policy to the database so that it can be evaluated.
This must be called every time the policy changes, usually as part of a deploy script.</p>
</dd></dl>
</dd></dl>
<dl class="py class">
<dt id="sqlalchemy_oso.roles2.Permission">
<em class="property">class </em><code class="sig-prename descclassname">sqlalchemy_oso.roles2.</code><code class="sig-name descname">Permission</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">python_class</span><span class="p">:</span> <span class="n">Any</span></em>, <em class="sig-param"><span class="n">name</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles2.Permission" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py class">
<dt id="sqlalchemy_oso.roles2.Relationship">
<em class="property">class </em><code class="sig-prename descclassname">sqlalchemy_oso.roles2.</code><code class="sig-name descname">Relationship</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">child_python_class</span><span class="p">:</span> <span class="n">Any</span></em>, <em class="sig-param"><span class="n">child_type</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">child_table</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">parent_python_class</span><span class="p">:</span> <span class="n">Any</span></em>, <em class="sig-param"><span class="n">parent_type</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">parent_table</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">parent_field</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles2.Relationship" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py class">
<dt id="sqlalchemy_oso.roles2.Resource">
<em class="property">class </em><code class="sig-prename descclassname">sqlalchemy_oso.roles2.</code><code class="sig-name descname">Resource</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">python_class</span><span class="p">:</span> <span class="n">Any</span></em>, <em class="sig-param"><span class="n">actions</span><span class="p">:</span> <span class="n">Set<span class="p">[</span>str<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">roles</span><span class="p">:</span> <span class="n">Set<span class="p">[</span>str<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles2.Resource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>
<dl class="py class">
<dt id="sqlalchemy_oso.roles2.Role">
<em class="property">class </em><code class="sig-prename descclassname">sqlalchemy_oso.roles2.</code><code class="sig-name descname">Role</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">name</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">python_class</span><span class="p">:</span> <span class="n">Any</span></em>, <em class="sig-param"><span class="n">permissions</span><span class="p">:</span> <span class="n">List<span class="p">[</span><a class="reference internal" href="#sqlalchemy_oso.roles2.Permission" title="sqlalchemy_oso.roles2.Permission">sqlalchemy_oso.roles2.Permission</a><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">implied_roles</span><span class="p">:</span> <span class="n">List<span class="p">[</span>str<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles2.Role" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>


<h2 id="sqlalchemy-oso-roles"><code class="docutils literal notranslate"><span class="pre">sqlalchemy_oso.roles</span></code><a class="headerlink" href="#sqlalchemy-oso-roles" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This module is included in the preview to enable migration.</p>
</div>
<span class="target" id="module-sqlalchemy_oso.roles"></span><dl class="py function">
<dt id="sqlalchemy_oso.roles.add_user_role">
<code class="sig-prename descclassname">sqlalchemy_oso.roles.</code><code class="sig-name descname">add_user_role</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">session</span></em>, <em class="sig-param"><span class="n">user</span></em>, <em class="sig-param"><span class="n">resource</span></em>, <em class="sig-param"><span class="n">role_name</span></em>, <em class="sig-param"><span class="n">commit</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles.add_user_role" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a user to a role for a specific resource.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy session</p></li>
<li><p><strong>user</strong> – user record (python object) to assign the role to</p></li>
<li><p><strong>role_name</strong> (<em>str</em>) – the name of the role to assign to the user</p></li>
<li><p><strong>commit</strong> (<em>boolean</em>) – flag to specify whether or not session should be committed after adding role; defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt id="sqlalchemy_oso.roles.delete_user_role">
<code class="sig-prename descclassname">sqlalchemy_oso.roles.</code><code class="sig-name descname">delete_user_role</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">session</span></em>, <em class="sig-param"><span class="n">user</span></em>, <em class="sig-param"><span class="n">resource</span></em>, <em class="sig-param"><span class="n">role_name</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">commit</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles.delete_user_role" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a user from a role for a specific resource.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy session</p></li>
<li><p><strong>user</strong> – user record (python object) to remove the role from</p></li>
<li><p><strong>role_name</strong> (<em>str</em>) – the name of the role to remove from the user. If not     provided, the function will remove all roles the user has for     <code class="docutils literal notranslate"><span class="pre">resource</span></code>.</p></li>
<li><p><strong>commit</strong> (<em>boolean</em>) – flag to specify whether or not session should be committed after deleting role; defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt id="sqlalchemy_oso.roles.enable_roles">
<code class="sig-prename descclassname">sqlalchemy_oso.roles.</code><code class="sig-name descname">enable_roles</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">oso</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles.enable_roles" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable the SQLAlchemy Role-Based Access Control base policy. This method activates the following polar rules:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">role_allow(role,</span> <span class="pre">action,</span> <span class="pre">resource)</span></code>:</dt><dd><p>Allows actors that have the role <code class="docutils literal notranslate"><span class="pre">role</span></code> to take <code class="docutils literal notranslate"><span class="pre">action</span></code> on
<code class="docutils literal notranslate"><span class="pre">resource</span></code>. <code class="docutils literal notranslate"><span class="pre">role</span></code> is a SQLAlchemy role model generated by
<a class="reference internal" href="#sqlalchemy_oso.roles.resource_role_class" title="sqlalchemy_oso.roles.resource_role_class"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sqlalchemy_oso.roles.resource_role_class()</span></code></a>. <code class="docutils literal notranslate"><span class="pre">resource</span></code>
is a SQLAlchemy model to which the <code class="docutils literal notranslate"><span class="pre">role</span></code> applies. Roles apply
to the resources they are scoped to, For example,
<code class="docutils literal notranslate"><span class="pre">OrganizationRole</span></code> roles apply to <code class="docutils literal notranslate"><span class="pre">Organization</span></code> resources.
Roles may also apply to resources as specified by
<code class="docutils literal notranslate"><span class="pre">resource_role_applies_to</span></code> Polar rules. E.g.,</p>
<div class="highlight-polar notranslate"><div class="highlight"><pre><span></span><span class="k">role_allow</span><span class="p">(</span>role<span class="p">:</span><span class="nc"> OrganizationRole</span><span class="p">{</span>name<span class="p">:</span> <span class="s">"MEMBER"</span><span class="p">},</span> <span class="s">"READ"</span><span class="p">,</span> org<span class="p">:</span><span class="nc"> Organization</span><span class="p">);</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">resource_role_applies_to(child_resource,</span> <span class="pre">parent_resource)</span></code>:</dt><dd><p>Permits roles that control access to <cite>parent_resource</cite> apply to
<cite>child_resource</cite> as well. <cite>parent_resource</cite> must be a resource
that has a resource role class associated with it (see
<a class="reference internal" href="#sqlalchemy_oso.roles.resource_role_class" title="sqlalchemy_oso.roles.resource_role_class"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sqlalchemy_oso.roles.resource_role_class()</span></code></a>). E.g.,</p>
<div class="highlight-polar notranslate"><div class="highlight"><pre><span></span><span class="c1">### An organization's roles apply to its child repositories</span>
<span class="k">resource_role_applies_to</span><span class="p">(</span>repo<span class="p">:</span><span class="nc"> Repository</span><span class="p">,</span> parent_org<span class="p">)</span><span class="k"> if</span>
    parent_org <span class="o">=</span> repo<span class="p">.</span>organization<span class="p">;</span>
</pre></div>
</div>
<p>The above rule makes it possible to write <cite>role_allow</cite> rules
between <cite>OrganizationRole</cite> and <cite>Repository</cite>. E.g.,</p>
<div class="highlight-polar notranslate"><div class="highlight"><pre><span></span><span class="k">role_allow</span><span class="p">(</span>role<span class="p">:</span><span class="nc"> OrganizationRole</span><span class="p">{</span>name<span class="p">:</span> <span class="s">"MEMBER"</span><span class="p">},</span> <span class="s">"READ"</span><span class="p">,</span> repo<span class="p">:</span><span class="nc"> Repository</span><span class="p">);</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">[resource_name]_role_order(["ROLE_NAME_1",</span> <span class="pre">"ROLE_NAME_2",...])</span></code>:</dt><dd><p>Specifies a hierarchical role order for built-in
resource-specific roles defined with
<a class="reference internal" href="#sqlalchemy_oso.roles.resource_role_class" title="sqlalchemy_oso.roles.resource_role_class"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sqlalchemy_oso.roles.resource_role_class()</span></code></a> The rule name
is the lower-cased resource model name followed by
<code class="docutils literal notranslate"><span class="pre">_role_order</span></code>. The only parameter is a list of role names in
hierarchical order. Roles to the left will inherit the
permissions of roles to the right. This is useful if any role
should inherit all the permissions of another role. It is not
required for all built-in roles to be specified in the list. E.g.,</p>
<div class="highlight-polar notranslate"><div class="highlight"><pre><span></span><span class="k">repository_role_order</span><span class="p">([</span><span class="s">"ADMIN"</span><span class="p">,</span> <span class="s">"MAINTAIN"</span><span class="p">,</span> <span class="s">"WRITE"</span><span class="p">,</span> <span class="s">"TRIAGE"</span><span class="p">,</span> <span class="s">"READ"</span><span class="p">]);</span>
</pre></div>
</div>
<p>Is the equivalent of writing:</p>
<div class="highlight-polar notranslate"><div class="highlight"><pre><span></span><span class="k">role_allow</span><span class="p">(</span>role<span class="p">:</span><span class="nc"> RepositoryRole</span><span class="p">{</span>name<span class="p">:</span> <span class="s">"ADMIN"</span><span class="p">},</span> _action<span class="p">,</span> _resource<span class="p">)</span><span class="k"> if</span>
    <span class="k">role_allow</span><span class="p">(</span>new RepositoryRole<span class="p">{</span>name<span class="p">:</span> <span class="s">"MAINTAIN"</span><span class="p">},</span> _action<span class="p">,</span> _resource<span class="p">);</span>

<span class="k">role_allow</span><span class="p">(</span>role<span class="p">:</span><span class="nc"> RepositoryRole</span><span class="p">{</span>name<span class="p">:</span> <span class="s">"MAINTAIN"</span><span class="p">},</span> _action<span class="p">,</span> _resource<span class="p">)</span><span class="k"> if</span>
    <span class="k">role_allow</span><span class="p">(</span>new RepositoryRole<span class="p">{</span>name<span class="p">:</span> <span class="s">"WRITE"</span><span class="p">},</span> _action<span class="p">,</span> _resource<span class="p">);</span>
</pre></div>
</div>
<p>…and so on.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>oso</strong> (<a class="reference internal" href="index.html#oso.Oso" title="oso.Oso"><em>Oso</em></a>) – The Oso instance used to evaluate the policy.</p>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt id="sqlalchemy_oso.roles.get_resource_roles">
<code class="sig-prename descclassname">sqlalchemy_oso.roles.</code><code class="sig-name descname">get_resource_roles</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">session</span></em>, <em class="sig-param"><span class="n">resource</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles.get_resource_roles" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all of the roles for a specific resource. E.g.,
get all the roles in Organization 1. Each role has a single user
associated with it, which can be accessed by calling <code class="docutils literal notranslate"><span class="pre">role.user</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy session</p></li>
<li><p><strong>resource</strong> – the resource record (python object) for which to get     the users and roles</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list of the user’s roles</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>List of roles associated with the <code class="docutils literal notranslate"><span class="pre">resource</span></code></p>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt id="sqlalchemy_oso.roles.get_resource_users_by_role">
<code class="sig-prename descclassname">sqlalchemy_oso.roles.</code><code class="sig-name descname">get_resource_users_by_role</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">session</span></em>, <em class="sig-param"><span class="n">resource</span></em>, <em class="sig-param"><span class="n">role_name</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles.get_resource_users_by_role" title="Permalink to this definition">¶</a></dt>
<dd><p>Get all of the users that have a specific role for a specific
resource. E.g., get all the users in Organization 1 that have the “OWNER”
role.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy session</p></li>
<li><p><strong>resource</strong> – the resource record (python object) for which to get     the users</p></li>
<li><p><strong>role_name</strong> (<em>str</em>) – the name of the role to get users for</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>List of users that have the <code class="docutils literal notranslate"><span class="pre">role_name</span></code> role for     <code class="docutils literal notranslate"><span class="pre">resource</span></code></p>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt id="sqlalchemy_oso.roles.get_user_roles">
<code class="sig-prename descclassname">sqlalchemy_oso.roles.</code><code class="sig-name descname">get_user_roles</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">session</span></em>, <em class="sig-param"><span class="n">user</span></em>, <em class="sig-param"><span class="n">resource_model</span></em>, <em class="sig-param"><span class="n">resource_id</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles.get_user_roles" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a user’s roles for all resources of a single resource type.
E.g., get all of a user’s repositories and their role for each
repository.
Or optionally, all roles scoped to a specific resource_id.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy session</p></li>
<li><p><strong>user</strong> – user record (python object) of the SQLAlchemy user model     associated with roles scoped to the supplied <code class="docutils literal notranslate"><span class="pre">resource_model</span></code></p></li>
<li><p><strong>resource_id</strong> – (optional) the resource id for which to get the user’s roles.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list of the user’s roles</p>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt id="sqlalchemy_oso.roles.reassign_user_role">
<code class="sig-prename descclassname">sqlalchemy_oso.roles.</code><code class="sig-name descname">reassign_user_role</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">session</span></em>, <em class="sig-param"><span class="n">user</span></em>, <em class="sig-param"><span class="n">resource</span></em>, <em class="sig-param"><span class="n">role_name</span></em>, <em class="sig-param"><span class="n">commit</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles.reassign_user_role" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all existing roles that a user has for a specific resource, and
reassign the user to a new role. If the user does not have any roles for
the given resource, the behavior is the same as
<a class="reference internal" href="#sqlalchemy_oso.roles.add_user_role" title="sqlalchemy_oso.roles.add_user_role"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sqlalchemy_oso.roles.add_user_role()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> (<em>sqlalchemy.orm.session.Session</em>) – SQLAlchemy session</p></li>
<li><p><strong>user</strong> – user record (python object) whose role should be reassigned</p></li>
<li><p><strong>role_name</strong> (<em>str</em>) – the name of the new role to assign to the user</p></li>
<li><p><strong>commit</strong> (<em>boolean</em>) – flag to specify whether or not session should be committed after reassigning role; defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li>
</ul>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt id="sqlalchemy_oso.roles.resource_role_class">
<code class="sig-prename descclassname">sqlalchemy_oso.roles.</code><code class="sig-name descname">resource_role_class</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">declarative_base</span></em>, <em class="sig-param"><span class="n">user_model</span></em>, <em class="sig-param"><span class="n">resource_model</span></em>, <em class="sig-param"><span class="n">role_choices</span></em>, <em class="sig-param"><span class="n">mutually_exclusive</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy_oso.roles.resource_role_class" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a resource-specific role Mixin
for SQLAlchemy models. The role mixin is an
<a class="reference external" href="https://docs.sqlalchemy.org/en/13/orm/basic_relationships.html#association-object">Association Object</a>
between the <code class="docutils literal notranslate"><span class="pre">user_model</span></code> and the <code class="docutils literal notranslate"><span class="pre">resource_model</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>declarative_base</strong> – The SQLAlchemy declarative base model that     the role model and all related models are mapped to.</p></li>
<li><p><strong>user_model</strong> – The SQLAlchemy model representing users that the     resource-specific roles can be assigned to. The generated Role mixin will     have a many-to-one (Foreign Key) relationship with this user model.     A many-to-many relationship to <code class="docutils literal notranslate"><span class="pre">resource_model</span></code> is added to <code class="docutils literal notranslate"><span class="pre">user_model</span></code>;     the relationship is named following the convention: <code class="docutils literal notranslate"><span class="pre">resource_model.__name__.lower()</span> <span class="pre">+</span> <span class="pre">"s"</span></code>.</p></li>
<li><p><strong>resource_model</strong> – The SQLAlchemy model representing resources that     the generated Role mixin will be scoped to. The Role mixin will     have a many-to-one (ForeignKey) relationship with this resource model.     A many-to-many relationship to <code class="docutils literal notranslate"><span class="pre">user_model</span></code> is added to <code class="docutils literal notranslate"><span class="pre">resource_model</span></code>;     the relationship is named <code class="docutils literal notranslate"><span class="pre">users</span></code>.     NOTE: only one role model can be created per resource model. Attempting to call     <code class="docutils literal notranslate"><span class="pre">resource_role_class()</span></code> more than once for the same resource model will result in     a <code class="docutils literal notranslate"><span class="pre">ValueError</span></code>.</p></li>
<li><p><strong>roles</strong> (<em>bool</em>) – An order-independent list of the built-in roles for this resource-specific role type.</p></li>
<li><p><strong>mutually_exclusive</strong> – Boolean flag that sets whether or not users     can have more than one role for a given resource. Defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>the ResourceRole mixin, which must then be mixed into a SQLAlchemy model for the role. E.g.,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">OrganizationRoleMixin</span> <span class="o">=</span> <span class="n">oso_roles</span><span class="o">.</span><span class="n">resource_role_class</span><span class="p">(</span>
    <span class="n">Base</span><span class="p">,</span> <span class="n">User</span><span class="p">,</span> <span class="n">Organization</span><span class="p">,</span> <span class="p">[</span><span class="s2">"OWNER"</span><span class="p">,</span> <span class="s2">"MEMBER"</span><span class="p">,</span> <span class="s2">"BILLING"</span><span class="p">]</span>
<span class="p">)</span>

<span class="k">class</span> <span class="nc">OrganizationRole</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="n">OrganizationRoleMixin</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</p>
</dd>
</dl>
</dd></dl>




          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2020-2021 Oso Security, Inc.
              
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script src="_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>