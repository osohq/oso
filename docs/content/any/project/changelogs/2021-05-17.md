---
title: Release 2021-05-17
menuTitle: 2021-05-17
any: true
description: >-
  Changelog for Release 2021-05-17 (sqlalchemy-oso 0.6.2, sqlalchemy-oso-preview
  0.1.0) containing new features, bug fixes, and more.
---

## `sqlalchemy-oso` 0.6.2

### Other bugs & improvements

- Authorized sessions now disable [baked queries][] by default because the
  caching mechanism can bypass authorization by using queries from the cache
  that were previously baked without authorization applied. If you understand
  the risks and still want to opt-in to the previous behavior of using baked
  queries, you can pass the `enable_baked_queries=True` keyword argument to
  `sqlalchemy_oso.authorized_sessionmaker()` and friends.

[baked queries]: https://docs.sqlalchemy.org/en/13/orm/extensions/baked.html

## `sqlalchemy-oso-preview` 0.1.0

### Breaking changes

{{% callout "Warning" "orange" %}}
  This release contains breaking changes. Be sure to follow migration steps
  before upgrading.
{{% /callout %}}

#### Deprecated `set_get_session` method

`set_get_session` is no longer available, as this method was used for the
previous version of roles support.

#### Replaced `action` parameter with `checked_permissions`

Previously, `sqlalchemy_oso.authorized_sessionmaker()` and friends expected
`sqlalchemy_oso.session.AuthorizedSession` to be constructed with an `action`
parameter. This action would then be used to return only authorized results
when querying for SQLAlchemy models via the session. However, it did not allow
much flexibility in that there was no way to map different actions to different
models if, for example, you wished to authorize the `"list_issues"` action for
`Repo`s and the `"read"` action for `Issue`s.

That level of granularity is now possible as the `action` parameter
for `sqlalchemy_oso.session.AuthorizedSession` and the `get_action`
parameter for `sqlalchemy_oso.authorized_sessionmaker()` and
`sqlalchemy_oso.session.scoped_session()` have been replaced by
`checked_permissions` and `get_checked_permissions`, respectively.

Previously:

```python {hl_lines=[4]}
Session = authorized_sessionmaker(
    get_oso=lambda: current_app.oso,
    get_user=lambda: g.current_user,
    get_action=lambda: "read",
    bind=engine,
)
```

Now:

```python {hl_lines=[4]}
Session = authorized_sessionmaker(
    get_oso=lambda: current_app.oso,
    get_user=lambda: g.current_user,
    get_action=lambda: {Issue: "read", Repo: "list_issues"},
    bind=engine,
)
```

Additionally, if you wish to skip all authorization checks for a
particular session, you can pass `checked_permissions=None` or
`get_checked_permissions=lambda: None`.

### New features

#### `SQLAlchemyOso` object provides a unified interface for `Oso` and `OsoRoles`

The `SQLAlchemyOso` object is now available to simplify the initialization of
Oso for SQLAlchemy.

Now, instead of the following:

```python
from oso import Oso
from sqlalchemy_oso import register_models
from sqlalchemy_oso.roles2 import OsoRoles
from sqlalchemy.ext.declarative import declarative_base

Base = declarative_base()
oso = Oso()
register_models(oso, Base)
oso_roles = OsoRoles(oso, Base, User, sessionmaker)
```

both `Oso` and `OsoRoles` are wrapped by `SQLAlchemyOso`:

```python
from sqlalchemy_oso import SQLAlchemyOso
from sqlalchemy.ext.declarative import declarative_base

Base = declarative_base()
oso = SQLAlchemyOso(Base)
oso.enable_roles(User, sessionmaker)
```

After calling `SQLAlchemyOso.enable_roles()`, the role management methods
defined on `OsoRoles` are available on `SQLAlchemyOso`.
